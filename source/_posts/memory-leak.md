title: Linux下C++内存泄漏检测和性能检测
date: 2014-10-31 16:14:08
tags:
- linux
- 内存泄漏
- memory leak
- C++
- valgrind
- memcheck
categories:
- linux
- C++

---

##内存泄漏 & 内存泄露 
应该是前者
<!--more-->
[维基百科 内存泄露 -- Wikipedia, the free encyclopedia.](http://zh.wikipedia.org/wiki/内存泄漏)中用的是“泄漏”。另外，“泄露”，多指信息，机密被不该知道的人知道了，而“泄漏”除了包含以上意思之外，还包括气体液体流出等，为什么我突然想做一个比喻：从嘴里出来的就是泄露，从菊花里出来的就是泄漏[抠鼻]。所以，当形容非抽象的东西跑出来的时候，应该用“泄漏”，也就应该是“内存泄漏”

---

##valgrind

在改一个组里的组件，因为C++写的不是特别多，所以改完了不太放心，一旦跑起来不崩溃，那最担心的就是内存泄漏的问题。弄了几天，记录一下。
网上查到了挺多工具，最后用的是[valgrind](http://valgrind.org), 优点是不用添加什么编译选项（不像*grpof*，需要在编译的时候使用`-pg`，但还是建议加调试选项，即`-g`，这样最后在看报告的时候会更清晰。关于如何在*cmake*中使用调试选项，在[这篇](http://lixipeng.me/2014/06/19/gdb-coredumped/)里提到过）。

###原理

我挺想能了解一下原理的，但现在还没有时间，所以如果以后有机会（因为肯定还会用到），希望能够把这个补上。

###使用

加入你的可执行文件是`libido arg1 arg2 ... `，那最简单的使用方法就是：

    valgrind --leak-check=yes libido arg1 arg2 ...
    
你的程序会比之前慢好多


